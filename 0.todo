# âœ… AI RP Chat â€“ Refaktoryzacja i RozwÃ³j (TODO)

Å¹rÃ³dÅ‚a:
- `dokumentacja.md` â€“ dokumentacja klas
- `Zaktualizowany-i-scalony-kod-JS.md` â€“ scalony kod ÅºrÃ³dÅ‚owy
- Feedback Kamila â€“ 12â€“13.09.2025

---

## ğŸ”§ Refaktoryzacja strukturalna

### UI i kontrola
- [ ] RozdzieliÄ‡ `ChatUI` na dwie warstwy: renderowanie vs interakcje uÅ¼ytkownika
- [ ] WydzieliÄ‡ `Dom` jako zaleÅ¼noÅ›Ä‡ przekazywanÄ… do klas (nie globalny singleton)
- [ ] PrzebudowaÄ‡ `PanelsController`:
  - [ ] Mobile: tylko jeden panel otwarty naraz
  - [ ] Desktop: oba panele mogÄ… byÄ‡ otwarte jednoczeÅ›nie
  - [ ] `setting-side-panel` sterowany ciasteczkiem (`COOKIE_PANELS`)
  - [ ] DodaÄ‡ metody: `addPanel()`, `isPanelOpen()`, `getOpenPanel()`, `destroy()`

### API i logika
- [ ] UjednoliciÄ‡ API `GalleryLoader` i `ImageResolver` â€“ wspÃ³lne metody: `loadImages()`, `clearCache()`, `preload(limit)`
- [ ] PrzenieÅ›Ä‡ `PromptValidator` i `EditValidator` do jednego moduÅ‚u `ValidationService`
- [ ] WydzieliÄ‡ `RequestRetryManager` jako niezaleÅ¼ny serwis z:
  - [ ] `isRetryable(error)`
  - [ ] `getBackoffTime(attempt)`
  - [ ] `onRetry(callback)`
  - [ ] `maxTotalTime` jako parametr

---

## ğŸ§ª TestowalnoÅ›Ä‡ i kontrakty

### Testy jednostkowe
- [ ] `BackendAPI` â€“ testy kontraktu odpowiedzi: `{ id, sender, text, tags?, duration?, avatarUrl? }`
- [ ] `RequestRetryManager` â€“ testy retry, backoff, limit czasu
- [ ] `EditValidator` â€“ testy reguÅ‚ walidacji w trybie strict/relaxed

### Testy integracyjne
- [ ] PrzepÅ‚yw: `sendPrompt()` â†’ AI â†’ `rateResponse()` â†’ `editResponse()` â†’ `submitEdit()`
- [ ] PrzepÅ‚yw: `loadGallery()` â†’ `renderImages()` â†’ `selectImage()`

### Kontrakty danych
- [ ] ZdefiniowaÄ‡ typ `Message`
- [ ] ZdefiniowaÄ‡ typ `Tag`
- [ ] ZdefiniowaÄ‡ typ `ImageResource`
- [ ] ZdefiniowaÄ‡ typ `PanelState` (dla ciasteczek)

---

## ğŸš€ Rozszerzenia klas

### ChatManager
- [ ] `sendPromptWithStreaming()` â€“ obsÅ‚uga streamingu odpowiedzi
- [ ] `abortPrompt()` â€“ anulowanie generowania (AbortController)
- [ ] `sendPromptWithRetry()` â€“ retry UX + logika z `RequestRetryManager`

### BackendAPI
- [ ] `uploadImage(file)` â€“ walidacja + POST
- [ ] `getSessionMessages()` â€“ pobieranie historii sesji
- [ ] `deleteMessage(id)` â€“ usuwanie wiadomoÅ›ci

### GalleryLoader / ImageResolver
- [ ] `clearCache()` â€“ czyszczenie cache obrazÃ³w
- [ ] `preload(limit)` â€“ preload z limitem i TTL

---

## ğŸ§  Stabilizacja UX

- [ ] `EditManager.submitEdit()` â€“ walidacja treÅ›ci, obsÅ‚uga bÅ‚Ä™dÃ³w, moÅ¼liwoÅ›Ä‡ anulowania
- [ ] `RatingForm.disable()` â€“ blokada po ocenie
- [ ] `ChatUI.clearChat()` â€“ reset widoku czatu
- [ ] `ChatUI.renderSystemMessage(msg)` â€“ komunikaty systemowe (np. bÅ‚Ä™dy, info)

---

## ğŸ BÅ‚Ä™dy do naprawy

- [ ] `enableEdit()` â€“ ReferenceError: `categorizeTag` is not defined
- [ ] `Diagnostics.runAll()` â€“ TypeError: `grouped[group].push` is not funkcjÄ…
- [ ] `TagsPanel` â€“ kontener nie jest elementem DOM
- [ ] `Utils.q()` â€“ brak elementu `#non-existent` â†’ poprawiÄ‡ logikÄ™ fallbacku
- [ ] `editResponse()` i `rateResponse()` â€“ nie dziaÅ‚ajÄ… (brak efektu w UI)

---

## ğŸ“š Dokumentacja dla Ciebie (etap 2)

- [ ] Generowanie opisÃ³w klas z perspektywy uÅ¼ytkownika (nie techniczna)
- [ ] Historia zmian klas (diff vs poprzednia wersja)
- [ ] Wizualizacja zaleÅ¼noÅ›ci klas (diagram SVG lub HTML)
- [ ] Raport zmian w stylu changeloga (v0.9.0 â†’ v1.0.0)

---

## ğŸ“¦ Dodatki i ergonomia

- [ ] Dodanie `@example` w JSDoc dla kluczowych metod
- [ ] Dodanie `@throws` dla metod mogÄ…cych rzucaÄ‡ bÅ‚Ä™dy
- [ ] Dodanie `@see` dla powiÄ…zanych klas/metod
- [ ] Ujednolicenie stylu JSDoc w caÅ‚ym projekcie
- [ ] Tryb debug zawsze aktywny â€“ bez przeÅ‚Ä…cznikÃ³w

